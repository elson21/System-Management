<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <strong>System Management</strong>
    </a>

    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicAuth">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>

  <div id="navbarBasicAuth" class="navbar-menu">
    <div class="navbar-start">
      <a class="navbar-item" href="/">
        Home
      </a>
      
      <!-- Protected routes - only show when authenticated -->
      <div id="authenticated-nav" style="display: none;">
        <a class="navbar-item"
            hx-get="/api/systems"
            hx-target="#main-content">
          Systems
        </a>
        <a class="navbar-item"
            hx-get="/api/dashboard"
            hx-target="#main-content">
          Dashboard
        </a>
        <a class="navbar-item"
            hx-get="/api/activity"
            hx-target="#main-content">
          Activity
        </a>
        
        <!-- Admin section - only show for admin users -->
        <div id="admin-nav" style="display: none;">
          <a class="navbar-item has-text-warning"
              href="/admin/create-user">
            <span class="icon">
              <i class="fas fa-user-plus"></i>
            </span>
            <span>Create User</span>
          </a>
        </div>
      </div>
    </div>

    <div class="navbar-end">
      <div class="navbar-item">
        <div class="buttons">
          <!-- Show when not authenticated -->
          <div id="guest-buttons">
            <a href="/login" class="button is-primary">
              <strong>Sign in</strong>
            </a>
          </div>
          
          <!-- Show when authenticated -->
          <div id="user-info" style="display: none;">
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link">
                <span id="user-name">User</span>
                <span id="admin-badge" class="tag is-warning is-small ml-2" style="display: none;">ADMIN</span>
              </a>
              <div class="navbar-dropdown is-right">
                <a class="navbar-item" href="/api/dashboard">
                  Dashboard
                </a>
                <a class="navbar-item" href="/api/systems">
                  Systems
                </a>
                <hr class="navbar-divider">
                <a class="navbar-item" href="#" onclick="logout()">
                  Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
// Check authentication status on page load
document.addEventListener('DOMContentLoaded', function() {
    checkAuthStatus();
});

// Check if user is authenticated
function checkAuthStatus() {
    const token = localStorage.getItem('access_token');
    const userEmail = localStorage.getItem('user_email');
    
    if (token && userEmail) {
        // User is authenticated
        document.getElementById('guest-buttons').style.display = 'none';
        document.getElementById('user-info').style.display = 'block';
        document.getElementById('authenticated-nav').style.display = 'flex';
        document.getElementById('user-name').textContent = userEmail;
        
        // Check if user is admin (this would need to be implemented based on your user data)
        // For now, we'll show admin features if the email contains 'admin'
        if (userEmail.toLowerCase().includes('admin')) {
            document.getElementById('admin-nav').style.display = 'block';
            document.getElementById('admin-badge').style.display = 'inline-block';
        }
    } else {
        // User is not authenticated
        document.getElementById('guest-buttons').style.display = 'block';
        document.getElementById('user-info').style.display = 'none';
        document.getElementById('authenticated-nav').style.display = 'none';
        document.getElementById('admin-nav').style.display = 'none';
    }
}

// Logout function
function logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('user_email');
    window.location.href = '/';
}

// Mobile menu toggle
document.addEventListener('DOMContentLoaded', () => {
  // Get all "navbar-burger" elements
  const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

  // Add a click event on each of them
  $navbarBurgers.forEach(el => {
    el.addEventListener('click', () => {
      // Get the target from the "data-target" attribute
      const target = el.dataset.target;
      const $target = document.getElementById(target);

      // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
      el.classList.toggle('is-active');
      $target.classList.toggle('is-active');
    });
  });
});
</script>